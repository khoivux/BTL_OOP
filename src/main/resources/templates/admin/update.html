<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.w3.org/1999/xhtml" xmlns:form="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Quản Trị</title>
    <link rel="stylesheet" th:href="@{/admin.css}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <header>
        <div class="d-flex justify-content-between align-items-center bg-success p-3">
            <h2 class="text-white">Trang quản trị</h2>
            <div>
                <span class="text-white">Xin chào, admin</span>
                <div class = "d-flex justify-content-end"><a th:href = "@{/admin/logout}" class = "text-light">đăng xuất</a></div>  <!--đăng xuất-->
            </div>
        </div>
    </header>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>                                      <!--về trang chủ-->
            <li class="breadcrumb-item active" aria-current="page"><a href="/admin">Trang quản trị</a></li>
            <li class="breadcrumb-item active" aria-current="page">Quản lý Homestay</li>
        </ol>
    </nav>
    <div class="container-fluid row m-0">
        <div class="managecol p-0 col-2">
            <div>Quản lý</div>
            <ul class = "manage px-3">
                <li> <a th:href="@{/admin/homestay-list}">Quản lý Homestay</a></li>                                      <!--qua page qlsp-->
                <li> <a th:href="@{/admin/user}">Quản lý khách hàng</a></li>                                    <!--qua page qlkh-->
            </ul>
        </div>
        <div class = "editcol col-10">
            <h3>Cập nhật Homestay</h3>
            <form class="border p-2 mb-2" id="listForm" enctype="multipart/form-data">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label class="id">Mã</label>
                        <input type="text" class="form-control" placeholder="Nhập mã Homestay" name="id" th:value="${homestay.id}" readonly />
                    </div>
                    <div class="form-group col-md-3">
                        <label class="name">Tên Homestay</label>
                        <input type="text" class="form-control" placeholder="Nhập tên Homestay" name="name" th:value="${homestay.name}"/>
                    </div>
                    <div class="form-group col-md-3">
                        <label class="price">Giá phòng Homestay</label>
                        <input type="text" class="form-control" placeholder="Nhập giá phòng Homestay" name="price" th:value="${homestay.price}" >
                    </div>
                    <div class="form-group col-md-6">
                        <label class="address">Địa chỉ</label>
                        <input type="text" class="form-control" placeholder="Nhập địa chỉ Homestay" name="address" th:value="${homestay.address}">
                    </div>
                    <div class="form-group col-md-12 ">
                        <label for="provinceid">Tỉnh/Thành phố</label>
                        <select name="provinceid" id="provinceid" required class="form-control">
                            <option th:value="${homestay.province}">Chọn Tỉnh/Thành phố</option>
                            <div th:each="province : ${provinces}">
                                <option th:value="${province.id}" th:text="${province.name}"></option>
                            </div>
                        </select>
                    </div>

                    <div class="form-group col-md-6">
                        <label>Ảnh Homestay</label>
                        <input type="file" class="form-control-file" th:name="'image'" />
                        <div>
                            <!-- Hiển thị ảnh hiện tại của Homestay -->
                            <img th:src="@{${homestay.image}}" alt="Ảnh Homestay" style="max-width: 200px;" />
                        </div>
                    </div>
                </div>
                <table class="table table-bordered">
                    <thead class="thead-light">
                    <tr>
                        <th style="width:30%">Ảnh Phòng</th>
                        <th style="width:15%">Loại Phòng</th>
                        <th style="width:5%">Số Lượng</th>
                        <th style="width:40%">Mô Tả Phòng</th>
<!--                        <th style="width:5%">Hành Động</th>-->
                    </tr>
                    </thead>
                    <tbody id="roomTable">
                    <!-- Lặp qua các phòng để hiển thị thông tin -->
                    <tr th:each="room, iterStat : ${homestay.rooms}">
                        <!-- Cột Ảnh Phòng -->
                        <td>
                            <input type="file" class="form-control-file" th:name="'rooms[' + ${iterStat.index} + '].image'" />
                            <img th:src="@{${room.imgURL}}" alt="Ảnh phòng" style="max-width: 100px;" />
                        </td>
                        <!-- Loại Phòng -->
                        <td>
                            <input type="text" class="form-control"
                                   th:name="${'rooms[' + iterStat.index + '].type'}"
                                   th:value="${room.type}" />
                        </td>
                        <!-- Số Lượng -->
                        <td>
                            <input type="number" class="form-control"
                                   th:name="${'rooms[' + iterStat.index + '].numbers'}"
                                   th:value="${room.numbers}" />
                        </td>
                        <!-- Mô Tả -->
                        <td>
                            <input type="text" class="form-control"
                                   th:name="${'rooms[' + iterStat.index + '].description'}"
                                   th:value="${room.description}" />
                        </td>
                        <!-- Cột Hành Động với nút Xóa -->
<!--                        <td>-->
<!--                            <button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">Xóa</button>-->
<!--                        </td>-->
                    </tr>
                    </tbody>
                </table>
                <div class="d-flex justify-content-end mb-1">
                    <button type="submit" class="btn btn-success" onclick="submitForm(event)" >Cập nhật</button>         <!-- sau khi bấm quay về trang qlsp-->
                </div>
            </form>
        </div>
    </div>
    <!-- Thông báo Cập nhật thành công -->
    <script>
        function submitForm(event) {
            // Ngừng việc gửi form theo mặc định
            event.preventDefault();

            // Lấy dữ liệu từ form
            const formData = new FormData(document.getElementById("listForm"));

            // Chuyển FormData thành đối tượng JSON để gửi
            const formObject = {};
            formData.forEach((value, key) => {
                // Nếu key đã tồn tại trong formObject, thì tạo một mảng để chứa tất cả các giá trị với key đó
                if (formObject[key]) {
                    if (Array.isArray(formObject[key])) {
                        formObject[key].push(value);
                    } else {
                        formObject[key] = [formObject[key], value];
                    }
                } else {
                    formObject[key] = value;
                }
            });

            // Gửi dữ liệu lên server
            fetch("/admin/homestay-add", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json", // Nếu gửi dưới dạng JSON
                },
                body: JSON.stringify(formObject), // Chuyển đổi đối tượng JavaScript thành JSON
            })
                .then(response => response.json())
                .then(data => {
                console.log("Dữ liệu đã được gửi thành công:", data);
                // Thực hiện hành động sau khi gửi thành công (ví dụ: thông báo, chuyển hướng)
            })
                .catch(error => {
                console.error("Có lỗi xảy ra:", error);
            });
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
